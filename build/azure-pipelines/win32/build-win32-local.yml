steps:
- task: NodeTool@0
  inputs:
    versionSpec: "10.17.0"
- powershell: |
    npm install -g yarn
  displayName: hernad - Install yarn with npm
#- task: UsePythonVersion@0
#  inputs:
#    versionSpec: '2.7.17'
#    addToPath: true
- powershell: |
    . build/azure-pipelines/win32/exec.ps1
    $ErrorActionPreference = "Stop"
    # 64-bit build
    $env:npm_config_arch="$(VSCODE_ARCH)"
    $env:CHILD_CONCURRENCY="1"
    # $env:VSCODE_MIXIN_PASSWORD="$(VSCODE_MIXIN_PASSWORD)"
    exec { yarn }
    # exec { npm run gulp -- hygiene }
    #exec { npm run monaco-compile-check }
    #exec { npm run strict-null-check }
    #exec { npm run gulp -- mixin }
    #exec { node build/azure-pipelines/common/installDistro.js }
    #exec { node build/lib/builtInExtensions.js }
  displayName: yarn prep

- powershell: |
    npx --node-arg --max-old-space-size=8196 gulp vscode-win32-$(VSCODE_ARCH)-min
    npx gulp vscode-win32-$(VSCODE_ARCH)-inno-updater
    npx --node-arg --max-old-space-size=8196  gulp vscode-win32-$(VSCODE_ARCH)-user-setup
  displayName: "win32 build $(VSCODE_ARCH) zip"

